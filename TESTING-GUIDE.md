# Windows Collector - ç«¯åˆ°ç«¯æµ‹è¯•æŒ‡å—

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ä»æ•°æ®é‡‡é›†åˆ°æœåŠ¡å™¨åŒæ­¥çš„å®Œæ•´æµç¨‹

**æµ‹è¯•æ—¥æœŸ**: 2026-02-27

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®è®¤æœåŠ¡è¿è¡ŒçŠ¶æ€

**åç«¯ API æœåŠ¡å™¨**ï¼ˆç«¯å£ 3000ï¼‰:
```bash
cd packages/api
npm run dev
```

æ£€æŸ¥ï¼š
- âœ… çœ‹åˆ° "Server started on port 3000"
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… æ²¡æœ‰é”™è¯¯æ—¥å¿—

**Windows Collector**ï¼ˆç«¯å£ 1430ï¼‰:
```bash
cd apps/desktop
npm run tauri:dev
```

æ£€æŸ¥ï¼š
- âœ… Tauri çª—å£æ‰“å¼€
- âœ… æ˜¾ç¤º React UI
- âœ… æ§åˆ¶å°æ²¡æœ‰é”™è¯¯

### 2. æµ‹è¯•ç”¨æˆ·å‡­æ®

```
Email: test@lifespan.local
Password: TestPass123!
```

### 3. æ•°æ®åº“å‡†å¤‡

```bash
# è¿æ¥åˆ° PostgreSQL
psql -h localhost -U lifespan -d lifespan

# æ£€æŸ¥æµ‹è¯•ç”¨æˆ·
SELECT id, email, username, is_active FROM users WHERE email = 'test@lifespan.local';

# æ£€æŸ¥è®¾å¤‡
SELECT * FROM devices WHERE user_id = '<æµ‹è¯•ç”¨æˆ·ID>';

# æ¸…ç©ºæ—§äº‹ä»¶ï¼ˆå¯é€‰ï¼‰
DELETE FROM events WHERE user_id = '<æµ‹è¯•ç”¨æˆ·ID>';
DELETE FROM sync_records WHERE user_id = '<æµ‹è¯•ç”¨æˆ·ID>';
```

---

## ğŸ§ª æµ‹è¯•æµç¨‹

### æµ‹è¯• 1: ç”¨æˆ·ç™»å½•å’Œé…ç½®

**æ­¥éª¤**:
1. å¯åŠ¨ Windows Collector åº”ç”¨
2. ç‚¹å‡»å³ä¸Šè§’ "Settings" æŒ‰é’®
3. é…ç½®æœåŠ¡å™¨ï¼š
   ```
   Server URL: http://localhost:3000
   JWT Token: <ä»åç«¯è·å–>
   Device ID: <è‡ªåŠ¨ç”Ÿæˆæˆ–ç•™ç©º>
   ```
4. ç‚¹å‡» "Save"

**é¢„æœŸç»“æœ**:
- âœ… è®¾ç½®ä¿å­˜æˆåŠŸ
- âœ… æ˜¾ç¤º "Settings saved" æç¤º
- âœ… åŒæ­¥çŠ¶æ€æ˜¾ç¤º "æœªåŒæ­¥"

**å¦‚ä½•è·å– JWT Token**:
```bash
# æ–¹æ³•1: ä½¿ç”¨ curl
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@lifespan.local","password":"TestPass123!","device_name":"Test Device"}'

# æ–¹æ³•2: ä½¿ç”¨æµè§ˆå™¨
# è®¿é—® http://localhost:3000/api/v1/auth/login
# Body: {"email":"test@lifespan.local","password":"TestPass123!","device_name":"Test Device"}
```

ä¿å­˜å“åº”ä¸­çš„ `access_token`ã€‚

---

### æµ‹è¯• 2: å¯åŠ¨æ•°æ®é‡‡é›†

**æ­¥éª¤**:
1. åœ¨ Windows Collector UI ä¸­ç‚¹å‡» "Start Tracking"
2. åˆ‡æ¢åˆ°ä¸åŒçš„åº”ç”¨ç¨‹åºï¼ˆChrome, VSCode, Explorerç­‰ï¼‰
3. ç­‰å¾… 30-60 ç§’

**é¢„æœŸç»“æœ**:
- âœ… æŒ‰é’®æ–‡å­—å˜ä¸º "Stop Tracking"
- âœ… æ˜¾ç¤º "Status: Running"
- âœ… æ˜¾ç¤ºé‡‡é›†ç»Ÿè®¡ï¼ˆäº‹ä»¶æ•°é‡ï¼‰

---

### æµ‹è¯• 3: è§¦å‘åŒæ­¥

**æ­¥éª¤**:
1. ç‚¹å‡» "Sync Now" æŒ‰é’®
2. è§‚å¯ŸåŒæ­¥çŠ¶æ€å˜åŒ–

**é¢„æœŸç»“æœ**:
- âœ… çŠ¶æ€å˜ä¸º "ğŸ”„ Syncing..."
- âœ… 1-3ç§’åçŠ¶æ€å˜ä¸º "âœ… Synced"
- âœ… æ˜¾ç¤º "Last sync: just now"
- âœ… å¾…åŒæ­¥äº‹ä»¶æ•°é‡å‡å°‘

**å¦‚æœå¤±è´¥**:
- âŒ çŠ¶æ€å˜ä¸º "âŒ Sync failed"
- âŒ æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ "Network error", "Auth failed"ï¼‰

---

### æµ‹è¯• 4: éªŒè¯æœåŠ¡å™¨æ•°æ®

**æ­¥éª¤**:
```bash
# è¿æ¥åˆ°æ•°æ®åº“
psql -h localhost -U lifespan -d lifespan

# æŸ¥è¯¢åŒæ­¥çš„äº‹ä»¶
SELECT
    id,
    event_type,
    timestamp,
    duration,
    app_name,
    category,
    synced_at
FROM events
WHERE user_id = '<æµ‹è¯•ç”¨æˆ·ID>'
ORDER BY timestamp DESC
LIMIT 10;

# æŸ¥è¯¢åŒæ­¥è®°å½•
SELECT
    sync_type,
    events_count,
    status,
    start_time,
    end_time
FROM sync_records
WHERE user_id = '<æµ‹è¯•ç”¨æˆ·ID>'
ORDER BY created_at DESC
LIMIT 5;
```

**é¢„æœŸç»“æœ**:
- âœ… events è¡¨ä¸­æœ‰æ–°è®°å½•
- âœ… encrypted_data å­—æ®µåŒ…å«åŠ å¯†æ•°æ®ï¼ˆBase64ï¼‰
- âœ… sync_records è¡¨æ˜¾ç¤ºæˆåŠŸçš„åŒæ­¥è®°å½•
- âœ… è®¾å¤‡çš„ last_seen_at å·²æ›´æ–°

---

### æµ‹è¯• 5: é”™è¯¯å¤„ç†

**æµ‹è¯• 5a: é”™è¯¯çš„ JWT Token**
```
1. Settings â†’ è¾“å…¥é”™è¯¯çš„ JWT Token
2. Save
3. ç‚¹å‡» "Sync Now"

é¢„æœŸ: âŒ æ˜¾ç¤º "Auth failed" æˆ– "401 Unauthorized"
```

**æµ‹è¯• 5b: é”™è¯¯çš„æœåŠ¡å™¨åœ°å€**
```
1. Settings â†’ Server URL: http://localhost:9999
2. Save
3. ç‚¹å‡» "Sync Now"

é¢„æœŸ: âŒ æ˜¾ç¤º "Network error" æˆ– "Connection refused"
```

**æµ‹è¯• 5c: æ— ç½‘ç»œè¿æ¥**
```
1. æ–­å¼€ç½‘ç»œè¿æ¥
2. ç‚¹å‡» "Sync Now"

é¢„æœŸ: âŒ æ˜¾ç¤º "Network error"
3. æ¢å¤ç½‘ç»œ
4. å†æ¬¡ç‚¹å‡» "Sync Now"

é¢„æœŸ: âœ… åŒæ­¥æˆåŠŸ
```

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### æµ‹è¯• 6: æ‰¹é‡åŒæ­¥æ€§èƒ½

**æ­¥éª¤**:
1. å¯åŠ¨é‡‡é›†ï¼ŒæŒç»­è¿è¡Œ 5-10 åˆ†é’Ÿ
2. ç§¯ç´¯ 100+ äº‹ä»¶
3. ç‚¹å‡» "Sync Now"
4. è®°å½•åŒæ­¥è€—æ—¶

**é¢„æœŸç»“æœ**:
- âœ… 100 ä¸ªäº‹ä»¶åŒæ­¥ < 2 ç§’
- âœ… CPU ä½¿ç”¨ç‡ < 10%
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®š

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ Windows Collector æ—¥å¿—

**Tauri å¼€å‘è€…å·¥å…·**:
1. æ‰“å¼€ Windows Collector åº”ç”¨
2. æŒ‰ `Ctrl + Shift + I` æ‰“å¼€ DevTools
3. æŸ¥çœ‹ Console æ ‡ç­¾é¡µ

**åç«¯æ—¥å¿—**:
```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
cd packages/api
npm run dev

# æ—¥å¿—ä¼šæ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸­
```

### å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜1: "Auth failed"**
- âœ… æ£€æŸ¥ JWT Token æ˜¯å¦æ­£ç¡®
- âœ… æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸï¼ˆ7å¤©æœ‰æ•ˆæœŸï¼‰
- âœ… é‡æ–°ç™»å½•è·å–æ–° Token

**é—®é¢˜2: "Network error"**
- âœ… æ£€æŸ¥åç«¯æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
- âœ… æ£€æŸ¥æœåŠ¡å™¨ URL æ˜¯å¦æ­£ç¡®
- âœ… æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

**é—®é¢˜3: "åŒæ­¥æˆåŠŸï¼Œä½†æ•°æ®åº“æ²¡æœ‰æ•°æ®"**
- âœ… æ£€æŸ¥ device_id æ˜¯å¦åŒ¹é…
- âœ… æ£€æŸ¥åç«¯æ—¥å¿—ä¸­çš„ SQL é”™è¯¯
- âœ… æ‰‹åŠ¨æŸ¥è¯¢æ•°æ®åº“éªŒè¯

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### åŸºç¡€åŠŸèƒ½
- [ ] ç”¨æˆ·ç™»å½•æˆåŠŸ
- [ ] é…ç½®æœåŠ¡å™¨ä¿å­˜æˆåŠŸ
- [ ] å¯åŠ¨/åœæ­¢é‡‡é›†æ­£å¸¸
- [ ] åŒæ­¥æŒ‰é’®ç‚¹å‡»å“åº”

### åŒæ­¥åŠŸèƒ½
- [ ] ç«‹å³åŒæ­¥æˆåŠŸ
- [ ] åŒæ­¥çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [ ] åŒæ­¥æ—¶é—´æ›´æ–°
- [ ] å¾…åŒæ­¥æ•°é‡æ­£ç¡®

### æ•°æ®éªŒè¯
- [ ] æœåŠ¡å™¨æ¥æ”¶åˆ°äº‹ä»¶
- [ ] encrypted_data å­˜åœ¨
- [ ] æ—¶é—´æˆ³æ­£ç¡®
- [ ] åº”ç”¨åç§°æ­£ç¡®

### é”™è¯¯å¤„ç†
- [ ] é”™è¯¯ Token æç¤º
- [ ] ç½‘ç»œé”™è¯¯æç¤º
- [ ] æœåŠ¡å™¨é”™è¯¯æç¤º
- [ ] é”™è¯¯åå¯æ¢å¤

### æ€§èƒ½
- [ ] 100 äº‹ä»¶åŒæ­¥ < 2s
- [ ] CPU ä½¿ç”¨ç‡ < 10%
- [ ] å†…å­˜ç¨³å®š

---

## ğŸ¯ é¢„æœŸæµ‹è¯•ç»“æœ

**æˆåŠŸæ ‡å‡†**:
- âœ… æ‰€æœ‰åŸºç¡€åŠŸèƒ½é€šè¿‡
- âœ… è‡³å°‘å®Œæˆä¸€æ¬¡æˆåŠŸçš„ç«¯åˆ°ç«¯åŒæ­¥
- âœ… æ•°æ®åº“ä¸­å¯ä»¥çœ‹åˆ°åŠ å¯†äº‹ä»¶
- âœ… é”™è¯¯åœºæ™¯æœ‰æ­£ç¡®çš„æç¤º

**ä¸‹ä¸€æ­¥**:
- ä¿®å¤å‘ç°çš„ bug
- ä¼˜åŒ–æ€§èƒ½ç“¶é¢ˆ
- å‡†å¤‡ Alpha ç‰ˆæœ¬å‘å¸ƒ

---

**æµ‹è¯•å®Œæˆåï¼Œè¯·æŠ¥å‘Šç»“æœ**:
1. é€šè¿‡çš„æµ‹è¯•é¡¹
2. å¤±è´¥çš„æµ‹è¯•é¡¹
3. å‘ç°çš„é—®é¢˜
4. æ€§èƒ½æ•°æ®

å‡†å¤‡å°±ç»ªåå¼€å§‹æµ‹è¯•ï¼ğŸš€
